<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>수어톡 - 채팅</title>
    
    <link rel="stylesheet" href="assets/chat.css">
    <!-- 카메라 팝업 CSS 추가 -->
    <link rel="stylesheet" href="assets/camera.css">

    <script>
        const token = localStorage.getItem("accessToken");
        if (!token) {
            alert("로그인이 필요합니다.");
            window.location.href = "login.html";
        }
    </script>
</head>
<body>

    <div class="main-container">
        <div class="sidebar">
            
            <div class="user-profile">
                <div>
                    <h3 id="myProfileName" style="margin:0; font-size:1.1rem;">내 이름</h3>
                </div>
                <div style="display:flex; gap:5px;">
                    <button onclick="openSettings()" class="btn-logout" style="font-size:12px; cursor:pointer;">⚙️ 설정</button>
                    <button onclick="logout()" class="btn-logout" style="font-size:12px; cursor:pointer;">로그아웃</button>
                </div>
            </div>

            <div class="sidebar-search">
                <div class="search-inputs">
                    <input type="text" id="searchName" placeholder="이름 검색">
                    <input type="text" id="searchId" placeholder="ID 검색">
                </div>
                <button onclick="searchUser()" class="btn-search">사용자 검색</button>
            </div>

            <div id="searchResultArea" style="display:none; border-bottom: 1px solid var(--border-color); padding: 10px; background-color: #fff9db;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 5px;">
                    <span style="font-weight:bold; font-size: 0.9rem;">검색 결과</span>
                    <button onclick="closeSearch()" style="border:none; background:none; cursor:pointer; font-size:0.8rem; color:#888;">✕ 닫기</button>
                </div>
                <div id="searchResultList"></div>
            </div>

            <div class="friend-list-area">
                <div style="padding: 0 5px 10px 5px; font-size: 0.9rem; color: #666; font-weight: bold;">내 친구 목록</div>
                <div id="friendList">
                    </div>
            </div>
        </div>

        <div class="chat-area" id="chatArea">
            <div class="chat-header" id="chatHeader">
                <span id="chatTitle">대화 상대를 선택해주세요</span>
            </div>

            <div class="chat-messages" id="messages">
                </div>

            <div class="chat-input">
                <!-- 📷 카메라 버튼 -->
                <button id="signCameraBtn" title="수어 입력">📷</button>
                <input type="text" id="messageInput" placeholder="메시지를 입력하세요..." onkeypress="if(event.keyCode==13) sendMessage()">
                <button onclick="sendMessage()">전송</button>
            </div>
        </div>
    </div>

    <!-- ===== 카메라 팝업 오버레이 ===== -->
    <div id="cameraOverlay"></div>

    <!-- ===== 카메라 팝업 ===== -->
    <div id="cameraModal">
        <header>
            <span>📹 수어 입력</span>
            <button id="closeCameraBtn">✖</button>
        </header>

        <video id="videoInput" width="480" height="360" autoplay playsinline></video>

        <!-- 🎮 제어 버튼 -->
        <div class="camera-controls">
            <button id="startBtn">▶️ 시작</button>
            <button id="stopBtn" disabled>⏹️ 종료</button>
        </div>

        <!-- 상태 표시 -->
        <div id="statusText"></div>
    </div>

    <div id="settingsModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            
            <div id="settingsMenu">
                <h3>⚙️ 설정</h3>
                <ul class="settings-list">
                    <li onclick="goToProfileEdit()">
                        <span>👤 회원 정보 수정 / 탈퇴</span>
                        <span style="color:#aaa;">&gt;</span>
                    </li>
                    
                    <li onclick="alert('준비 중인 기능입니다.')">
                        <span>🔔 알림 설정</span>
                        <span style="color:#aaa;">&gt;</span>
                    </li>
                    <li onclick="alert('준비 중인 기능입니다.')">
                        <span>📺 화면 설정 (수어 영상 등)</span>
                        <span style="color:#aaa;">&gt;</span>
                    </li>
                    <li onclick="alert('현재 버전: 1.0.0')">
                        <span>ℹ️ 버전 정보</span>
                        <span style="color:#aaa;">1.0.0</span>
                    </li>
                </ul>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="closeSettings()" class="btn-secondary">닫기</button>
                </div>
            </div>

            <div id="settingsEditProfile" style="display:none;">
                <div style="display:flex; align-items:center; margin-bottom:20px;">
                    <button onclick="showSettingsMenu()" style="border:none; background:none; cursor:pointer; font-size:1.2rem; margin-right:10px;">⬅️</button>
                    <h3 style="margin:0;">내 정보 수정</h3>
                </div>
                
                <div class="input-group">
                    <label>이름</label>
                    <input type="text" id="editName">
                </div>
                <div class="input-group">
                    <label>전화번호</label>
                    <input type="text" id="editPhone">
                </div>
                <div class="input-group">
                    <label>새 비밀번호</label>
                    <input type="password" id="editPw" placeholder="변경 시에만 입력하세요">
                </div>
                
                <div style="display:flex; gap:10px; margin-top:20px;">
                    <button onclick="updateMember()" class="btn-primary" style="flex:1;">수정 완료</button>
                </div>

                <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
                
                <div style="text-align:right;">
                    <button onclick="deleteMember()" style="color:#999; background:none; border:none; text-decoration:underline; cursor:pointer; font-size:12px;">
                        회원 탈퇴하기
                    </button>
                </div>
            </div>

        </div>
    </div>
    
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <!-- MediaPipe 라이브러리 -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

    <script src="js/chat.js"></script>
    <!-- 카메라 기능 스크립트 -->
    <script src="js/camera.js"></script>
</body>
</html>